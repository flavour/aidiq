$(document).ready(function(){var I=$("#inv_track_item_send_inv_item_id");if(I.length){var E,P,a,k=S3.supply.binnedQuantity||0,A,U=$("#inv_track_item_sub_defaultsend_bin__row"),B,F,C,J,m,r,ba=$("#quantity__error"),d,x=$("#sub-defaultsend_bin"),ia=$("#inv_track_item_sub_defaultsend_bin"),y,ja=S3.supply.inv_items,V,h,Q=$("#inv_track_item_item_pack_id"),R,ka=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none"),n=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none"),z=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_none-hierarchy"),
ca=/(\d)(?=(\d{3})+(?!\d))/g,la=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_0"),u=$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0"),D,ma=$("#sub_defaultsend_bin_defaultsend_bin_i_layout_id_edit_0-hierarchy"),da,e,b,K,L,S,ea,l=$("#inv_track_item_quantity"),W=$("#inv_track_item_req_item_id__row"),v,M,G=I.val(),w,fa=S3.supply.itemPackID,X=1,g;$('div[id^="sub_defaultsend_bin_defaultsend_bin_i_layout_id"].s3-hierarchy-widget');var T,Y;W.length&&W.hide();var aa=function(){Z?(T=function(f){f.quantity.value=
c;f.quantity.text=c.toString().replace(ca,"$1,")},x.inlinecomponent("updateRows",T),$("#edt-defaultsend_bin-0").hide(),$("#rmv-defaultsend_bin-0").hide()):(U.show(),B=J[C[0]],B*h>c*b?n.val(c):n.val(B*h/b))};I.on("change.s3",function(f,t){y=I.val();Q.html("");t||(Z=!1,l.val(""),c=0,x.inlinecomponent("removeRows"),k=0);$("#TotalQuantity").remove();if(y){f=ja[y];V=f.q;L=f.p;S=L.length;v=f.r;for(d=0;d<S;d++)if(e=L[d],1==e.q){ea=e.n;break}for(d=0;d<S;d++){e=L[d];if(void 0!=e.d){var ha=!0;h=e.q}else ha=
!1;fa&&G==y&&fa==e.i?(R=e.i,D=X=b=e.q,K=e.n,M=" selected"):ha?(R=e.i,D=b=e.q,K=e.n,M=" selected"):M="";da=1!==e.q?'<option value="'+e.i+'"'+M+">"+e.n+" ("+e.q+" x "+ea+")</option>":'<option value="'+e.i+'"'+M+">"+e.n+"</option>";Q.append(da)}t&&(k=k*h/b);J=f.b;C=[];for(layoutID in J)C.push(layoutID);m=C.length;if(0==m)U.hide();else if(1==m)if(Z)$("#add-row-defaultsend_bin").hide(),$("#read-row-defaultsend_bin-0 > .subform-action").hide(),x.off("click.inlinecomponent",".read-row");else{aa();var N=
function(){z.hierarchicalopts("set",[C[0]]);n.attr("disabled",!0);$("#add-row-defaultsend_bin > .subform-action").hide();z.next(".s3_inline_add_resource_link").hide();$(".s3-hierarchy-button").attr("disabled",!0)};if(z.is(":data('s3-hierarchicalopts')"))N();else z.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()})}else if(U.show(),N=function(){n.prop("disabled",!1);$("#add-row-defaultsend_bin > .subform-action").show();z.next(".s3_inline_add_resource_link").show();$(".s3-hierarchy-button").prop("disabled",
!1);z.hierarchicalopts("show",C,!0);ma.hierarchicalopts("show",C,!0)},z.is(":data('s3-hierarchicalopts')"))N();else z.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){N()});if(ba.length)for(f=ba.html().split(" "),d=0;d<f.length&&!(g=parseFloat(f[d]));d++);else g=V*h/b,w&&G==y&&(g+=w*X/b);f='<span id="TotalQuantity"> / '+g.toFixed(2)+" "+K+" ("+i18n.in_inv+")</span>";l.after(f);if(v){var p=v[0];Y=function(){if(1==v.length){if(!w||G!=y){var q=p.q/b;c=q<=g?q:g;l.val(c);1==m&&aa()}$("#inv_track_item_req_item_id").val(p.i)}else{W.show();
var O=$("#inv_track_item_req_item_id"),H=O.val();H&&=parseInt(H);O.html("");for(d=0;d<v.length;d++)p=v[d],O.append(new Option(p.r,p.i)),H?p.i!=H||w&&G==y||(q=p.q/b,q<=g?l.val(q):l.val(g)):t&&(q=p.q/b,q<=g?l.val(q):l.val(g)),t=!1;O.on("change",function(){H=parseInt(O.val());for(d=0;d<v.length;d++)if(p=v[d],p.i==H){q=p.q/b;q<=g?l.val(q):l.val(g);break}})}};Y()}}});Q.on("change.s3",function(){R=parseInt(Q.val());for(d=0;d<S;d++)if(e=L[d],e.i==R){b=e.q;K=e.n;g=V*h/b;w&&G==y&&(g+=w*X/b);$("#TotalQuantity").html(g.toFixed(2)+
" "+K+" ("+i18n.in_inv+")");c=l.val();c=c*D/b;l.val(c);a=n.val();a=a*D/b;n.val(a);a=u.val();a=a*D/b;u.val(a);T=function(f){a=f.quantity.value;a=a*D/b;f.quantity.value=a;f.quantity.text=a.toString().replace(ca,"$1,")};x.inlinecomponent("updateRows",T);D=b;v&&Y();break}});if(G){var Z=!0;0==k&&(k=(k=u.val())?parseFloat(k):0);var c=(w=l.val())?w=parseFloat(w):0;I.trigger("change.s3",!0)}l.change(function(){(c=l.val())?(c=parseFloat(c),$("#inv_track_item_quantity-warning").remove()):c=0;message=null;c>
g?(c=g,message="Total Quantity reduced to Quantity in Stock"):0>c&&(c=0,message="Total Quantity cannot be negative");1==m?aa():1<m&&(A=k*h/b,c<A&&(c=A,message="Total Quantity increased to Quantity in Bins"),n.change());message&&(r=$('<div id="inv_track_item_quantity-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),l.val(c).parent().append(r).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();
return!1}))});n.change(function(){if(1<m&&(a=n.val())){a=parseFloat(a);if(P=ka.val())B=J[P],F=B*h/b,a>F&&(a=F,message="Bin Quantity reduced to Quantity of Stock in Bin",r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),n.val(a).parent().append(r).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();
return!1}));A=k*h/b;E=c-A;a>E&&(message="Bin Quantity reduced to Quantity remaining to be Sent",r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),n.val(E).parent().append(r).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))}});u.change(function(){if(1<m&&(a=u.val())){a=parseFloat(a);
if(P=la.val())B=J[P],F=B*h/b,a>F&&(a=F,message="Bin Quantity reduced to Quantity of Stock in Bin",r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),u.val(a).parent().append(r).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}));A=k*h/b;E=c-A;a>E&&(message="Bin Quantity reduced to Quantity remaining to be Sent",
r=$('<div id="sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),u.val(E).parent().append(r).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))}});x.on("click.s3",".inline-edt",function(){1<m&&(a=u.val())&&(a=parseFloat(a),k-=a*b/h)});$("#rdy-defaultbin-0").on("click",function(){if(1<m){if(a=u.val())a=
parseFloat(a),k+=a*b/h;n.change()}});x.on("editCancelled",function(f,t){a=parseFloat(ia.data("data").data[t].quantity.value);k+=a*b/h});x.on("rowAdded",function(f,t){if(1<m){if(a=t.quantity.value)a=parseFloat(a),k+=a*b/h;$("#sub_defaultsend_bin_defaultsend_bin_i_quantity_edit_none-warning").remove()}});x.on("rowRemoved",function(f,t){1<m&&(a=t.quantity.value)&&(a=parseFloat(a),k-=a*b/h)})}});
