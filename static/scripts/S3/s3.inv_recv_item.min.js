$(document).ready(function(){var y=$("#inv_track_item_item_id");if(y.length){var I,E=S3.supply.packs||{},v,a,h=S3.supply.binnedQuantity||0,B,k,F,w=$("#sub-defaultrecv_bin"),O=$("#inv_track_item_sub_defaultrecv_bin"),n=y.val(),z=$("#inv_track_item_item_pack_id"),C,l,A=$("#sub_defaultrecv_bin_defaultrecv_bin_i_quantity_edit_none"),P=/(\d)(?=(\d{3})+(?!\d))/g,p=$("#sub_defaultrecv_bin_defaultrecv_bin_i_quantity_edit_0"),q,J,r,D,G,K,d,e=$("#inv_track_item_quantity"),m=$("#inv_track_item_recv_quantity"),
b,Q=S3.supply.req_data||{},t,x=$("#inv_track_item_req_item_id"),H=$("#inv_track_item_req_item_id__row"),c,L;H.length&&H.hide();var M=function(){F=!0;D=E[n];G={};K=D.length;z.html("");for(i=0;i<K;i++)r=D[i],G[r.i]=r.q,F?(C=r.i,q=d=r.q,selected=" selected"):selected="",F=!1,J='<option value="'+r.i+'"'+selected+">"+r.n+"</option>",z.append(J)};y.on("change.s3",function(u,f){n=y.val();(D=E[n])?M():(I=S3.Ap.concat("/supply/item_packs.json/"+n),$.ajaxS3({url:I,dataType:"json",success:function(R){E[n]=R;
M()}}));if(f)(c=e.val())&&(c=parseFloat(c)),b=(b=m.val())?parseFloat(b):c;else{e.val("");m.val("");if(t=Q[n])if(1==t.length){var g=t[0];c=g.q/d;e.val(c);x.val(g.i)}else{H.show();var N;x.html("");f=!0;for(i=0;i<t.length;i++)g=t[i],x.append(new Option(g.r,g.u)),f&&(c=g.q/d,e.val(void 0)),f=!1;x.on("change",function(){N=parseInt(x.val());for(i=0;i<t.length;i++)if(g=t[i],g.i==N){c=g.q/d;e.val(c);break}})}else x.val(""),c=0;b=0;w.inlinecomponent("removeRows");h=0}});n&&(startingItemPackID=C=z.val(),y.trigger("change.s3",
!0));z.on("change.s3",function(){C=z.val();d=G[C];if(c=e.val())c=parseFloat(c),c=c*q/d,e.val(totalQuantity),(b=m.val())?(b=parseFloat(b),b=b*q/d,m.val(b)):b=c;a=A.val();a=a*q/d;A.val(a);a=p.val();a=a*q/d;p.val(a);L=function(u){a=u.quantity.value;a=a*q/d;u.quantity.value=a;u.quantity.text=a.toString().replace(P,"$1,")};w.inlinecomponent("updateRows",L);q=d});e.on("change",function(){(c=e.val())?(c=parseFloat(c),(b=m.val())?(b=parseFloat(b),b>c&&(l="Quantity Sent increased to Quantity Received",k=$('<div class="alert alert-warning" style="padding-left:36px;">'+
l+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),c=b,e.val(b).parent().append(k).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))):b=c):c=b=0});m.change(function(){(b=m.val())?(b=parseFloat(b),b>c&&(l="Quantity Received reduced to Quantity Sent",k=$('<div class="alert alert-warning" style="padding-left:36px;">'+l+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),b=c,m.val(c).parent().append(k).off(".s3").on("click.s3",
".alert",function(){$(this).fadeOut("slow").remove();return!1}))):b=c});A.change(function(){if(a=A.val())a=parseFloat(a),B=1*h/d,v=b-B,a>v&&(l="Bin Quantity reduced to Quantity remaining to be Received",k=$('<div class="alert alert-warning" style="padding-left:36px;">'+l+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),A.val(v).parent().append(k).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))});p.change(function(){if(a=p.val())a=
parseFloat(a),B=1*h/d,v=b-B,a>v&&(l="Bin Quantity reduced to Quantity remaining to be Received",k=$('<div id="sub_defaultrecv_bin_defaultrecv_bin_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+l+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),p.val(v).parent().append(k).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))});w.on("click.s3",".inline-edt",function(){if(a=p.val())a=parseFloat(a),
h-=a*d});$("#rdy-defaultbin-0").on("click",function(){if(a=p.val())a=parseFloat(a),h+=a*d});w.on("editCancelled",function(u,f){a=parseFloat(O.data("data").data[f].quantity.value);h+=a*d});w.on("rowAdded",function(u,f){if(a=f.quantity.value)a=parseFloat(a),h+=a*d});w.on("rowRemoved",function(u,f){if(a=f.quantity.value)a=parseFloat(a),h-=a*d})}});
