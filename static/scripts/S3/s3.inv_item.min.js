$(document).ready(function(){var w=$("#inv_inv_item_item_id");if(w.length){var p,D=S3.supply.packs||{},q,a,e=S3.supply.binnedQuantity||0,h,r,E,t=$("#sub-defaultbin"),M=$("#inv_inv_item_sub_defaultbin"),u=w.val(),y=$("#inv_inv_item_item_pack_id"),z,k=$("#sub_defaultbin_defaultbin_i_quantity_edit_none"),N=/(\d)(?=(\d{3})+(?!\d))/g,l=$("#sub_defaultbin_defaultbin_i_quantity_edit_0"),m,d,A,F,I,b,B=$("#inv_inv_item_site_id"),G=S3.supply.itemPackID,f=1,v=$("#inv_inv_item_quantity"),c=v.val(),C,J;if(B.length){var O=
$('a[id^="inv"].s3_add_resource_link'),P=/%5Bid%5D/g,H=B.val(),x,K=$('div[id^="sub_defaultbin_defaultbin_i_layout_id"].s3-hierarchy-widget');if(K.length)B.on("change",function(){t.inlinecomponent("removeRows");x=B.val();p=S3.Ap.concat("/org/site/"+x+"/layout/hierarchy.tree");K.hierarchicalopts("reload",p);O.each(function(){C=$(this);p=H?C.attr("href").replace(H,x):C.attr("href").replace(P,x);C.attr("href",p)});H=x})}var L=function(g){E=!0;A=D[u];F={};I=A.length;y.html("");for(i=0;i<I;i++)d=A[i],F[d.i]=
d.q,G&&G==d.i?(z=G,m=f=b=d.q,selected=" selected"):E?(z=d.i,m=b=d.q,selected=" selected"):selected="",E=!1,opt='<option value="'+d.i+'"'+selected+">"+d.n+"</option>",y.append(opt)};w.on("change.s3",function(g,n){u=w.val();(A=D[u])?L(n):(p=S3.Ap.concat("/supply/item_packs.json/"+u),$.ajaxS3({url:p,dataType:"json",success:function(Q){D[u]=Q;L()}}))});u&&(c=c?parseFloat(c):0,w.trigger("change.s3",!0));y.on("change.s3",function(){z=y.val();b=F[z];c=v.val();c=c*m/b;v.val(c);a=k.val();a=a*m/b;k.val(a);
a=l.val();a=a*m/b;l.val(a);J=function(g){a=g.quantity.value;a=a*m/b;g.quantity.value=a;g.quantity.text=a.toString().replace(N,"$1,")};t.inlinecomponent("updateRows",J);m=b});v.on("change",function(){c=(c=v.val())?parseFloat(c):0;h=e*f/b;c<h&&(message="Total Quantity reduced to Quantity in Bins",r=$('<div class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),v.val(h).parent().append(r).off(".s3").on("click.s3",
".alert",function(){$(this).fadeOut("slow").remove();return!1}));k.trigger("change")});k.on("change",function(){if(a=k.val())a=parseFloat(a),h=e*f/b,q=c-h,a>q&&(message="Bin Quantity reduced to Available Quantity",r=$('<div class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),k.val(q).parent().append(r).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))});l.on("change",
function(){if(a=l.val())a=parseFloat(a),h=e*f/b,q=c-h,a>q&&(message="Bin Quantity reduced to Available Quantity",r=$('<div class="alert alert-warning" style="padding-left:36px;">'+message+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),l.val(q).parent().append(r).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))});t.on("click.s3",".inline-edt",function(){if(a=l.val())a=parseFloat(a),e-=a*b/f});$("#rdy-defaultbin-0").on("click",
function(){if(a=l.val())a=parseFloat(a),e+=a*b/f;k.trigger("change")});t.on("editCancelled",function(g,n){a=parseFloat(M.data("data").data[n].quantity.value);e+=a});t.on("rowAdded",function(g,n){if(a=n.quantity.value)a=parseFloat(a),e+=a*b/f});t.on("rowRemoved",function(g,n){if(a=n.quantity.value)a=parseFloat(a),e-=a*b/f})}});
