$(document).ready(function(){var t=$("#inv_req_item_quantity_reserved");if(t.length){var c,d,a,n,D,E,p,x=$("#sub-defaultreq_item_inv"),P=$("#inv_req_item_sub_defaultreq_item_inv"),f,g,e,F=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_inv_item_id_edit_none"),K=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_none"),m=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none"),G=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_none-hierarchy"),Q=/(\d)(?=(\d{3})+(?!\d))/g,
H=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_inv_item_id_edit_0"),L=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_0"),q=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0"),M=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_0-hierarchy"),B,I,v=S3.supply.reqData||{},k=v.b||0,l=v.i||{},y=v.r,N=$("#inv_req_item_quantity"),z=0,b=t.val();b=b?parseFloat(b):0;v="<span> / "+v.q.toFixed(2)+" "+v.p+" ("+i18n.in_inv+")</span>";t.after(v);t.change(function(){(b=
t.val())?(b=parseFloat(b),$("#inv_req_item_quantity_reserved-warning").remove()):b=0;b>y?(b=y,e="Quantity Reserved decreased to Quantity Requested",p=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(b).parent().append(p).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1})):0>b&&(b=0,e="Quantity Reserved cannot be negative",
p=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(b).parent().append(p).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}));z?I?(d=l[f].b[g]+k,a=Math.min(b,d),updateQuantity=function(h){h.quantity.value=a;h.quantity.text=a.toString().replace(Q,"$1,")},x.inlinecomponent("updateRows",updateQuantity),$("#edt-defaultreq_item_inv-0").hide(),
$("#rmv-defaultreq_item_inv-0").hide()):(c=b-k,d=l[f].b[g],a=Math.min(c,d),m.val(a)):b<k&&(b=k,e="Quantity Reserved increased to Quantity in Bins",p=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(b).parent().append(p).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))});N.change(function(){y=(y=N.val())?parseFloat(y):
0;b>y&&t.change()});m.change(function(){if(a=m.val())c=b-k,a=parseFloat(a),e=null,(f=F.val())?(g=K.val())?(d=l[f].b[g],c>=d?a>d&&(e="Bin Quantity reduced to Quantity in Bin"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):(d=l[f].q,c>=d?a>d&&(e="Bin Quantity reduced to Quantity of Stock Item"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):a>c&&(e="Bin Quantity reduced to Quantity Reserved"),e&&(p=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+
e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),m.val(c).parent().append(p).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))});F.change(function(){if(f=F.val()){D=l[f].b;n=[];for(g in D)n.push(g);E=n.length;1==E?I?($("#add-row-defaultreq_item_inv").hide(),$("#read-row-defaultreq_item_inv-0 > .subform-action").hide(),x.off("click.inlinecomponent",".read-row"),B=function(){}):(g=n[0],B=function(){G.hierarchicalopts("set",[g]);
$(".s3-hierarchy-button").attr("disabled","disabled");z?(c=b-k,d=l[f].b[g],m.val(Math.min(c,d)).attr("disabled",!0),$("#add-row-defaultreq_item_inv > .subform-action").hide()):(a=m.val())?m.change():(c=b-k,d=l[f].b[g],m.val(Math.min(c,d)))}):(z=!1,B=function(){$(".s3-hierarchy-button").prop("disabled",!1);G.hierarchicalopts("show",n,!0);m.change()});if(G.is(":data('s3-hierarchicalopts')"))B();else G.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){B()})}});K.change(function(){m.change()});
for(f in l)z++;1==z?(k&&(I=!0),F.val(f).attr("disabled",!0).change()):z=!1;q.change(function(){if(a=q.val())c=b-k,a=parseFloat(a),e=null,(f=H.val())?(g=L.val())?(d=l[f].b[g],c>=d?a>d&&(e="Bin Quantity reduced to Quantity in Bin"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):(d=l[f].q,c>=d?a>d&&(e="Bin Quantity reduced to Quantity of Stock Item"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):(c=b-k,a>c&&(e="Bin Quantity reduced to Quantity Reserved")),e&&(p=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+
e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),q.val(c).parent().append(p).off(".s3").on("click.s3",".alert",function(){$(this).fadeOut("slow").remove();return!1}))});H.change(function(){if(f=H.val()){D=l[f].b;n=[];for(g in D)n.push(g);E=n.length;1==E?(g=n[0],M.hierarchicalopts("set",[g]),$(".s3-hierarchy-button").attr("disabled","disabled"),(a=q.val())?q.change():(c=b-k,d=l[f].b[g],q.val(Math.min(c,d)))):($(".s3-hierarchy-button").prop("disabled",!1),M.hierarchicalopts("show",
n),q.change())}});L.change(function(){q.change()});x.on("click.s3",".inline-edt",function(){a=(a=q.val())?parseFloat(a):0;k-=a});$("#rdy-defaultbin-0").on("click",function(){a=(a=q.val())?parseFloat(a):0;k+=a;m.change()});x.on("editCancelled",function(h,r){a=parseFloat(P.data("data").data[r].quantity.value);k+=a});x.on("rowAdded",function(h,r){k+=parseFloat(r.quantity.value);$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning").remove()});x.on("rowRemoved",function(h,r){k-=
parseFloat(r.quantity.value)})}$(document).on("click",".quantity.ajax_more",function(h){h.preventDefault();h=$(this);if(h.hasClass("collapsed")){if(h.hasClass("fulfil")){var r="recv";var J="track_item"}else h.hasClass("transit")?(r="send",J="track_item"):h.hasClass("commit")&&(r="commit",J="commit_item");h.after('<div class="ajax_throbber quantity_req_ajax_throbber"/>').removeClass("collapsed").addClass("expanded");var u,w,O,C=$(".action-btn",h.parent().parent().parent()).attr("href");C=/req_item\/(\d*).*/i.exec(C)[1];
C=S3.Ap.concat("/inv/",r,"_item_json.json/",C);$.ajax({url:C,dataType:"json",context:h}).done(function(A){w='<table class="recv_table">';for(u=0;u<A.length;u++)w+="<tr><td>",0===u?w+=A[0].id:(O=S3.Ap.concat("/inv/",r,"/",A[u].id,"/"+J),w+="<a href='"+O+"'>"+A[u].name+" - "+A[u].date+"</a>"),w+="</td><td>"+A[u].quantity+"</td></tr>";w+="</table>";$(".quantity_req_ajax_throbber",this.parent()).remove();this.parent().after(w)})}else h.removeClass("expanded").addClass("collapsed"),$(".recv_table",h.parent().parent()).remove()})});
