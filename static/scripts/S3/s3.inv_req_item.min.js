$(document).ready(function(){var t=$("#inv_req_item_quantity_reserved");if(t.length){var c,d,a,n,C,D,p,x=$("#sub-defaultreq_item_inv"),O=$("#inv_req_item_sub_defaultreq_item_inv"),f,g,e,E=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_inv_item_id_edit_none"),J=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_none"),m=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none"),F=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_none-hierarchy"),P=/(\d)(?=(\d{3})+(?!\d))/g,
G=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_inv_item_id_edit_0"),K=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_0"),q=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0"),L=$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_layout_id_edit_0-hierarchy"),A,H,v=S3.supply.reqData||{},k=v.b||0,l=v.i||{},M=v.r,y=0,b=t.val();b=b?parseFloat(b):0;v="<span> / "+v.q.toFixed(2)+" "+v.p+" ("+i18n.in_inv+")</span>";t.after(v);t.change(function(){(b=t.val())?(b=parseFloat(b),
$("#inv_req_item_quantity_reserved-warning").remove()):b=0;b>M?(b=M,e="Quantity Reserved decreased to Quantity Requested",p=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(b).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1})):0>b&&(b=0,e="Quantity Reserved cannot be negative",p=
$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(b).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}));y?H?(d=l[f].b[g]+k,a=Math.min(b,d),updateQuantity=function(h){h.quantity.value=a;h.quantity.text=a.toString().replace(P,"$1,")},x.inlinecomponent("updateRows",updateQuantity),$("#edt-defaultreq_item_inv-0").hide(),
$("#rmv-defaultreq_item_inv-0").hide()):(c=b-k,d=l[f].b[g],a=Math.min(c,d),m.val(a)):b<k&&(b=k,e="Quantity Reserved increased to Quantity in Bins",p=$('<div id="inv_req_item_quantity_reserved-warning" class="alert alert-warning" style="padding-left:36px;">'+e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),t.val(b).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});m.change(function(){if(a=m.val())c=
b-k,a=parseFloat(a),e=null,(f=E.val())?(g=J.val())?(d=l[f].b[g],c>=d?a>d&&(e="Bin Quantity reduced to Quantity in Bin"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):(d=l[f].q,c>=d?a>d&&(e="Bin Quantity reduced to Quantity of Stock Item"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):a>c&&(e="Bin Quantity reduced to Quantity Reserved"),e&&(p=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning" class="alert alert-warning" style="padding-left:36px;">'+
e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),m.val(c).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});E.change(function(){if(f=E.val()){C=l[f].b;n=[];for(g in C)n.push(g);D=n.length;1==D?H?($("#add-row-defaultreq_item_inv").hide(),$("#read-row-defaultreq_item_inv-0 > .subform-action").hide(),x.off("click.inlinecomponent",".read-row"),A=function(){}):(g=n[0],A=function(){F.hierarchicalopts("set",
[g]);$(".s3-hierarchy-button").attr("disabled","disabled");y?(c=b-k,d=l[f].b[g],m.val(Math.min(c,d)).attr("disabled",!0),$("#add-row-defaultreq_item_inv > .subform-action").hide()):(a=m.val())?m.change():(c=b-k,d=l[f].b[g],m.val(Math.min(c,d)))}):(y=!1,A=function(){$(".s3-hierarchy-button").removeAttr("disabled");F.hierarchicalopts("show",n,!0);m.change()});if(F.is(":data('s3-hierarchicalopts')"))A();else F.find(".s3-hierarchy-tree").first().on("ready.jstree",function(){A()})}});J.change(function(){m.change()});
for(f in l)y++;1==y?(k&&(H=!0),E.val(f).attr("disabled",!0).change()):y=!1;q.change(function(){if(a=q.val())c=b-k,a=parseFloat(a),e=null,(f=G.val())?(g=K.val())?(d=l[f].b[g],c>=d?a>d&&(e="Bin Quantity reduced to Quantity in Bin"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):(d=l[f].q,c>=d?a>d&&(e="Bin Quantity reduced to Quantity of Stock Item"):a>c&&(e="Bin Quantity reduced to Quantity Reserved")):(c=b-k,a>c&&(e="Bin Quantity reduced to Quantity Reserved")),e&&(p=$('<div id="sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_0-warning" class="alert alert-warning" style="padding-left:36px;">'+
e+'<button type="button" class="close" data-dismiss="alert">\u00d7</button></div>'),q.val(c).parent().append(p).undelegate(".s3").delegate(".alert","click.s3",function(){$(this).fadeOut("slow").remove();return!1}))});G.change(function(){if(f=G.val()){C=l[f].b;n=[];for(g in C)n.push(g);D=n.length;1==D?(g=n[0],L.hierarchicalopts("set",[g]),$(".s3-hierarchy-button").attr("disabled","disabled"),(a=q.val())?q.change():(c=b-k,d=l[f].b[g],q.val(Math.min(c,d)))):($(".s3-hierarchy-button").removeAttr("disabled"),
L.hierarchicalopts("show",n),q.change())}});K.change(function(){q.change()});x.on("click.s3",".inline-edt",function(){a=(a=q.val())?parseFloat(a):0;k-=a});$("#rdy-defaultbin-0").click(function(){a=(a=q.val())?parseFloat(a):0;k+=a;m.change()});x.on("editCancelled",function(h,r){a=parseFloat(O.data("data").data[r].quantity.value);k+=a});x.on("rowAdded",function(h,r){k+=parseFloat(r.quantity.value);$("#sub_defaultreq_item_inv_defaultreq_item_inv_i_quantity_edit_none-warning").remove()});x.on("rowRemoved",
function(h,r){k-=parseFloat(r.quantity.value)})}$(document).on("click",".quantity.ajax_more",function(h){h.preventDefault();h=$(this);if(h.hasClass("collapsed")){if(h.hasClass("fulfil")){var r="recv";var I="track_item"}else h.hasClass("transit")?(r="send",I="track_item"):h.hasClass("commit")&&(r="commit",I="commit_item");h.after('<div class="ajax_throbber quantity_req_ajax_throbber"/>').removeClass("collapsed").addClass("expanded");var u,w,N,B=$(".action-btn",h.parent().parent().parent()).attr("href");
B=/req_item\/(\d*).*/i.exec(B)[1];B=S3.Ap.concat("/inv/",r,"_item_json.json/",B);$.ajax({url:B,dataType:"json",context:h}).done(function(z){w='<table class="recv_table">';for(u=0;u<z.length;u++)w+="<tr><td>",0===u?w+=z[0].id:(N=S3.Ap.concat("/inv/",r,"/",z[u].id,"/"+I),w+="<a href='"+N+"'>"+z[u].name+" - "+z[u].date+"</a>"),w+="</td><td>"+z[u].quantity+"</td></tr>";w+="</table>";$(".quantity_req_ajax_throbber",this.parent()).remove();this.parent().after(w)})}else h.removeClass("expanded").addClass("collapsed"),
$(".recv_table",h.parent().parent()).remove()})});
